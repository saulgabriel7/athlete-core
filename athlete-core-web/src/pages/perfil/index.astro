---
/**
 * ATHLETE CORE - Perfil Page
 * P√°gina de perfil com design premium
 */

import DashboardLayout from '../../layouts/DashboardLayout.astro';
import UserInfo from '../../modules/usuario/UserInfo.astro';
import Card from '../../components/common/Card.astro';
import Button from '../../components/common/Button.astro';
import SectionTitle from '../../components/common/SectionTitle.astro';
import { getCurrentUser, getUserId } from '../../services/clerkServer';
import { getUser } from '../../services/mcpClient';
import type { User } from '../../types/user';

// Obt√©m dados do Clerk
const clerkUser = await getCurrentUser(Astro.locals);
const userId = getUserId(Astro.locals);

// Tenta obter dados do MCP
let mcpUser: User | null = null;
if (userId) {
  try {
    const response = await getUser(userId);
    if (response.success) {
      mcpUser = response.data;
    }
  } catch (e) {
    // Silently fail - usu√°rio pode n√£o existir no MCP ainda
  }
}
---

<DashboardLayout title="Perfil" pageTitle="Meu Perfil">
  <div class="page-header">
    <Button href="/perfil/editar" variant="outline">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/>
      </svg>
      Editar Perfil
    </Button>
  </div>

  <UserInfo 
    user={mcpUser || undefined} 
    clerkUser={clerkUser || undefined} 
  />

  {!mcpUser && (
    <Card class="setup-notice">
      <div class="notice-icon">üëã</div>
      <div class="notice-content">
        <h3>Complete seu perfil</h3>
        <p>
          Para ter acesso a todas as funcionalidades como treinos personalizados e planos alimentares,
          configure seus dados f√≠sicos e objetivos.
        </p>
        <Button href="/perfil/editar" variant="primary" size="sm">
          Configurar Agora
        </Button>
      </div>
    </Card>
  )}
</DashboardLayout>

<style>
  .page-header {
    display: flex;
    justify-content: flex-end;
    margin-bottom: var(--spacing-lg);
  }

  .setup-notice {
    margin-top: var(--spacing-xl);
    display: flex;
    gap: var(--spacing-lg);
    align-items: flex-start;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
    border-color: rgba(59, 130, 246, 0.2);
    animation: fadeInUp var(--transition-base) ease-out;
    max-width: 800px;
  }

  .setup-notice:hover {
    border-color: rgba(59, 130, 246, 0.4);
  }

  .notice-icon {
    font-size: var(--font-size-3xl);
    flex-shrink: 0;
  }

  .notice-content {
    flex: 1;
  }

  .notice-content h3 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-foreground);
  }

  .notice-content p {
    color: var(--color-foreground-muted);
    margin: 0 0 var(--spacing-md) 0;
    line-height: var(--line-height-relaxed);
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
